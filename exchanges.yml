openapi: 3.0.0
info:
  version: "0.0.3-unstable"
  title: VC Exchanges API
  description: This is an Experimental Open API Specification for the [VC Data Model](https://www.w3.org/TR/vc-data-model/).
  license:
    name: W3C Software and Document License
    url: http://www.w3.org/Consortium/Legal/copyright-software.
  contact:
    name: GitHub Source Code
    url: https://github.com/w3c-ccg/vc-api
paths:
  /workflows:
    post:
      summary: Creates a new workflow and returns its information in the response body.
      tags:
        - Credentials
      security:
        - networkAuth: []
        - oAuth2: []
        - zCap: []
      operationId: createWorkflow
      description: Creates a new workflow and returns workflowId in the response body.
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateWorkflowRequest"
      responses:
        "200":
          description: Workflow successfully created!
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreateWorkflowResponse"
        "400":
          description: Invalid input
        "401":
          description: Not Authorized
        "500":
          description: Internal Error
  /workflows/{workflowId}:
    get:
      summary: Gets the configuration of an existing workflow and returns it in the response body.
      tags:
        - Credentials
      security:
        - networkAuth: []
        - oAuth2: []
        - zCap: []
      operationId: getWorkflowConfiguration
      description: Gets the configuration of an existing workflow and returns it in the response body.
      responses:
        "200":
          description: Workflow configuration retrieved!
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetWorkflowResponse"
        "400":
          description: Invalid input
        "401":
          description: Not Authorized
        "500":
          description: Internal Error
  /workflows/{workflowId}/exchanges:
    post:
      summary: Passing an empty body to this endpoint creates a new exchange and returns exchangeId and time to live in the response body.
      tags:
        - Credentials
      security:
        - networkAuth: []
        - oAuth2: []
        - zCap: []
      operationId: createExchange
      description: Creates a new exchange and returns exchangeId and time to live in the response body.
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateExchangeRequest"
      responses:
        "200":
          description: Exchange successfully created!
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreateExchangeResponse"
        "400":
          description: Invalid input
        "401":
          description: Not Authorized
        "500":
          description: Internal Error
  /workflows/{workflowId}/exchanges/{exchangeId}:
    get:
      summary: Gets the state of an existing exchange and returns it in the response body.
      tags:
        - Credentials
      security:
        - networkAuth: []
        - oAuth2: []
        - zCap: []
      operationId: getExchangeConfiguration
      description: Gets the configuration of an existing exchange and returns it in the response body.
      responses:
        "200":
          description: Exchange configuration retrieved!
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetExchangeResponse"
        "400":
          description: Invalid input
        "401":
          description: Not Authorized
        "500":
          description: Internal Error
    post:
      summary: Participate in an exchange by passing either a credential to be issued or a Verifiable Presentation. Posting an empty body will start the exchange.
      tags:
        - Credentials
      security:
        - networkAuth: []
        - oAuth2: []
        - zCap: []
      operationId: participateInExchange
      description: Participate in an exchange by passing either a credential to be issued or a Verifiable Presentation. Posting an empty body will start the exchange.
      requestBody:
        content:
          application/json:
            schema:
              oneOf:
              - $ref: "./components/VerifiablePresentation.yml#/components/schemas/VerifiablePresentation"
              - $ref: "./components/Credential.yml#/components/schemas/Credential"
        description: Either
      responses:
        "200":
          description: Exchange completed!
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "./components/IssueCredentialSuccess.yml#/components/schemas/IssueCredentialSuccess"
                  - $ref: "./components/VerifyPresentationResult.yml#/components/schemas/VerificationResult"
        "400":
          description: Invalid input
        "401":
          description: Not Authorized
        "500":
          description: Internal Error
components:
  schemas:
    CreateWorkflowRequest:
      type: object
      additionalProperties: false
      description: Object containing information for creating a workflow.
      properties:
        required:
          type: object
          properties:
            steps:
              type: object
              description: A set of semantically named steps to be used in exchanges created on this workflow.
              items:
                type: object
            initialStep:
              type: string
              description: The step from the above set that the exchange starts on.
        options:
          type: object
          properties:
            controller:
              type: string
              description: The controller of the instance.
            authorization:
              type: object
              description: Authorization scheme information (e.g. OAuth2 configuration).
            credentialTemplates:
              type: array
              description: One or more VC templates for issuance.
              items:
                $ref: "#/components/schemas/VerifiableCredentialTemplate"
    CreateWorkflowResponse:
      type: object
      additionalProperties: false
      description: Object containing information about a created workflow.
      properties:
        workflowId:
          type: string
          description: An identifier for the created workflow.
    GetWorkflowResponse:
      type: object
      additionalProperties: false
      description: Object containing information about a workflow.
      properties:
        required:
          type: object
          properties:
            exchanges:
              type: array
              description: The identifiers of the current exchanges associated with the workflow instance.
              items:
                type: string
            steps:
              type: object
              description: A set of semantically named steps to be used in exchanges created on this workflow.
              items:
                type: object
            initialStep:
              type: string
              description: The step from the above set that the exchange starts on.
        options:
          type: object
          properties:
            controller:
              type: string
              description: The controller of the instance.
            authorization:
              type: object
              description: Authorization scheme information (e.g. OAuth2 configuration).
            credentialTemplates:
              type: array
              description: One or more VC templates for issuance.
              items:
                $ref: "#/components/schemas/VerifiableCredentialTemplate"
    CreateExchangeRequest:
      type: object
      additionalProperties: false
      description: Object containing information about the exchange to be created.
      properties:
        ttl:
          type: string
          description: Time to live for the exchange (ms).
        variables:
          type: array
          description: Template variables to be used in the exchange. MAY be empty.
          items:
            type: object
    CreateExchangeResponse:
      type: object
      additionalProperties: false
      description: Object containing information about a created exchange.
      properties:
        exchangeId:
          type: string
          description: An identifier for the created exchange <exchangeID, absolute URL>.
        sequence:
          type: string
          description: A sequence number for the exchange. Set to "0" on creation.
        ttl:
          type: string
          description: The time to live for the created exchange.
        variables:
          type: array
          description: Template variables to be used in the exchange.
          items:
            type: object
        state:
          type: string
          description: The status ("pending" | "complete" | "invalid") of the exchange, set to "pending" on creation.
    GetExchangeResponse:
      type: object
      additionalProperties: false
      description: Object containing information about an active exchange.
      properties:
        exchangeId:
          type: string
          description: An identifier for the exchange <exchangeID, absolute URL>
        ttl:
          type: string
          description: The time to live for the exchange.
        nextStep:
          type: string
          description: The interaction the exchange is expecting to happen next.
        completedSteps:
          type: array
          description: The steps completed by the exchange previously.
          items:
            type: string
    VerifiableCredentialTemplate:
      type: object
      additionalProperties: false
      description: A Verifiable Credential template.
      properties:
        type:
          type: string
          description: The type of template.
        template:
          type: string
          description: The VC template.
